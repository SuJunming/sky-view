defaultTasks 'push'

project.group = 'frameHub'
project.version = 'service-0.0.1'

ext {
    env = System.getenv()
}

task npminstall(type: Exec){
    // commandLine 'npm', 'install', '--registry=https://registry.npm.taobao.org'
    commandLine 'echo', 'npminstall'
}

task test(type: Exec, dependsOn: 'npminstall') {
    commandLine 'echo', 'test'
}

task build(type: Exec, dependsOn: 'test') {
    workingDir '.'
    commandLine 'docker', 'build', '-t', "${env.DOCKER_REPO}/${project.group}/${project.name}:${project.version}-build.${env.BUILD_NUMBER}", '-f', 'docker/Dockerfile', '.'
}

task push(type: Exec, dependsOn: 'build') {
    commandLine 'docker', 'push', "${env.DOCKER_REPO}/${project.group}/${project.name}:${project.version}-build.${env.BUILD_NUMBER}"
}
